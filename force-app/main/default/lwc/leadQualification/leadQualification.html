<template>
    <lightning-card title="AI Lead Qualification" icon-name="standard:lead">
        <div class="slds-p-around_medium">
            <!-- Lead Information -->
            <template if:true={hasLeadData}>
                <div class="lead-info-section">
                    <h3 class="slds-text-heading_small slds-m-bottom_small">Lead Information</h3>
                    <div class="lead-info-grid">
                        <div class="lead-info-item">
                            <div class="lead-info-label">Name</div>
                            <div class="lead-info-value">{leadName}</div>
                        </div>
                        <div class="lead-info-item">
                            <div class="lead-info-label">Company</div>
                            <div class="lead-info-value">{leadCompany}</div>
                        </div>
                        <div class="lead-info-item">
                            <div class="lead-info-label">Email</div>
                            <div class="lead-info-value">{leadEmail}</div>
                        </div>
                        <div class="lead-info-item">
                            <div class="lead-info-label">Phone</div>
                            <div class="lead-info-value">{leadPhone}</div>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Qualification Button -->
            <div class="slds-m-bottom_medium">
                <lightning-button 
                    variant="brand" 
                    label="Qualify Lead with AI" 
                    onclick={handleQualifyLead}
                    disabled={isLoading}
                    class="slds-m-right_small">
                </lightning-button>
                
                <template if:true={showResults}>
                    <lightning-button 
                        variant="neutral" 
                        label="Refresh Analysis" 
                        onclick={handleRefresh}>
                    </lightning-button>
                </template>
            </div>

            <!-- Loading Spinner -->
            <template if:true={isLoading}>
                <div class="slds-is-relative slds-m-vertical_medium">
                    <lightning-spinner alternative-text="Analyzing lead..." size="medium"></lightning-spinner>
                </div>
            </template>

            <!-- Qualification Results -->
            <template if:true={showResults}>
                <template if:true={qualificationResult}>
                    <div class="qualification-results slds-box slds-theme_shade">
                        <h3 class="slds-text-heading_small slds-m-bottom_medium">AI Qualification Results</h3>
                        
                        <!-- Score and Grade -->
                        <div class="slds-grid slds-wrap slds-m-bottom_medium">
                            <div class="slds-col slds-size_1-of-2">
                                <div class="score-display">
                                    <span class="slds-text-heading_large {scoreClass}">{qualificationResult.score}</span>
                                    <span class="slds-text-body_regular slds-m-left_x-small">/ 100</span>
                                </div>
                                <div class="slds-text-color_weak">Qualification Score</div>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <div class="grade-display">
                                    <span class="slds-text-heading_large {gradeClass}">{qualificationResult.grade}</span>
                                </div>
                                <div class="slds-text-color_weak">Grade</div>
                            </div>
                        </div>

                        <!-- Next Action -->
                        <div class="slds-m-bottom_medium">
                            <h4 class="slds-text-heading_x-small slds-m-bottom_x-small">Recommended Next Action:</h4>
                            <div class="slds-box slds-theme_info slds-p-around_small">
                                {qualificationResult.nextAction}
                            </div>
                        </div>

                        <!-- Strengths -->
                        <template if:true={qualificationResult.strengths}>
                            <div class="slds-m-bottom_medium">
                                <h4 class="slds-text-heading_x-small slds-m-bottom_x-small">Key Strengths:</h4>
                                <ul class="slds-list_dotted">
                                    <template for:each={qualificationResult.strengths} for:item="strength">
                                        <li key={strength} class="slds-item">{strength}</li>
                                    </template>
                                </ul>
                            </div>
                        </template>

                        <!-- Recommendations -->
                        <template if:true={qualificationResult.recommendations}>
                            <div class="slds-m-bottom_medium">
                                <h4 class="slds-text-heading_x-small slds-m-bottom_x-small">Recommendations:</h4>
                                <ul class="slds-list_dotted">
                                    <template for:each={qualificationResult.recommendations} for:item="recommendation">
                                        <li key={recommendation} class="slds-item">{recommendation}</li>
                                    </template>
                                </ul>
                            </div>
                        </template>
                    </div>
                </template>
            </template>
        </div>

        <!-- Footer Actions -->
        <template slot="footer">
            <lightning-button-group>
                <lightning-button 
                    variant="neutral" 
                    label="Close" 
                    onclick={handleClose}>
                </lightning-button>
            </lightning-button-group>
        </template>
    </lightning-card>
</template>
